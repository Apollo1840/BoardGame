# 效果估值

## 基本估值： 

```python
DMG = 1 dmg = 0.2 （value）
# 一点伤害估值 0.2 
# 不使用dmg来做基本单位的原因是为了更好的锚定灵力

V = 0.2     # 战斗结算时的一点攻击力或防御力
MANA = 1    # 一点灵力估值为1

# 注意：以下价值没有对应行为
HC = 1     # 一张手牌估值为1
FC = 3     # 一张场牌估值为3

# 行为
AK = 1     # 一次攻击/技能/预言发动估值为1，即我方场上随机一只怪物或永续预言进行行动
```

## 基础公式： 

作用对方即为输出取负，即：
```python
-f(x) # 等于 当 f 行为 发生在对方时的价值估计
```

触发价值直接根据价值估计计算， 即
```python
-(1/p)*f(y) + g
# 等于 当 f 行为发生时，执行 g 行为的价值估计
# p 代表 f 发生概率矫正，概率矫正根据具体事件计算

q = -1/p # 正向触发系数

# 免疫公式
if p<1: - f(<-x) + f(>x)  = 0  

 # 下界估计公式
f(>=y) > f(y)  => -f(>y) < -f(y+1) 

```


## 具体估值
### 伤害行为


基本定义：
```python
DMG(x) = 0.2*x
-> DMG(-x) = -DMG(x)
-> DMG(a*x) = a*DMG(x)

# 例如：
DMG(5) = 1    # 给予对方5点伤害估值为 1
-DMG(-5) = 1  # 给予我方5点恢复估值为 1
DMG(10) = 2   # 给予对方10点伤害估值为 2
```

行为表：
| Explanation | Source  | Target | Target effect | Formula | 
|:------|:------------|:-----------|:------------|--------------:|
| 我方给予对方伤害 | 我方      | 对方 | 伤害  |  DMG(x) |
| 我方给予对方恢复 | 我方      | 对方 | 恢复  | DMG(-x) |
| 我方给予我方伤害 | 我方      | 我方 | 伤害  | -DMG(x) |
| 我方给予我方恢复 | 我方      | 我方 | 恢复  | -DMG(-x)|
| 对方给予我方伤害 | 对方      | 我方 | 伤害  | -DMG(x)|
| 对方给予我方恢复 | 对方      | 我方 | 恢复  | -DMG(-x)|
| 对方给予对方伤害 | 对方      | 对方 | 伤害  | DMG(x)|
| 对方给予对方恢复 | 对方      | 对方 | 恢复  | DMG(-x)|

- 不论来源


推论：
```python
-DMG(5)-DMG(-5) = 0
# 当对方给我方造成5伤害时，恢复5信仰

(-1)*DMG(5)-DMG(-5) = 0
# 当我方给对方造成5伤害时: 恢复5信仰 

-DMG(>4)-DMG(<-4) = 0
# 当对方给我方造成5及其以上伤害时，免疫其伤害

-DMG(>4)-DMG(<-4)-DMG(-10)= 2 
# 当对方给予我方5及其以上伤害时，免疫其伤害，并我方得到10点恢复
```


高阶定义：
```python
DMG.A(x) = DMG(x*0.8) = 0.16*x
DMG.E(x) = DMG(x) = 0.2*x
1/p(DMG.A) = 1.1  # 对方主动给我方造成，或我方由于其他操作给对方造成
1/p(DMG.E) = 1.5  # 对方主动给我方造成，或我方由于其他操作给对方造成

# 例如：
DMG.A(6) = 0.96 ~ 1 
# 发动攻击，给予6点战斗伤害

DMG.A(13) = 2.08 ~ 2

-1.1*DMG.A(1) + DMG.A(7)  = 0.94 ~ 1
# 当我方给对方造成了战斗伤害，追加7点战斗伤害

-1.5*DMG.E(>1) + DMG.E(8)  = 1
# 当我方给对方造成了大于1点效果伤害，追加8点效果伤害
```

推论：
```python

# 当对方给我方造成了5以上战斗伤害时，恢复5信仰
-1.1*DMG.A(>5)-DMG(-5)
< -1.1*DMG.A(6)-DMG(-5) 
= 0.05 ~ 0

(-1)*1.1*DMG.A(6)+DMG(5) = 0.05 ~ 0
# 当我方给对方造成了5点战斗伤害时，对方信仰-5

-DMG.E(5) + DMG.A(6) = -0.04 ~ 0
# 我方信仰-5，某战斗伤害加6

-1.5*DMG.E(1) + DMG.A(2)= 0.02 ～ 0
# 当我方此回合受到效果伤害时，某战斗伤害加2

-1.1*DMG.A(>5) + DMG(5) = 0
# 当我方此回合受到5以上战斗伤害时，给予对方5伤害

```

高阶定义：
```python
DMG.E2() ~ -0.02 # 某次效果伤害翻倍
(-1)*1.5*DMG.E(>1) + DMG.E(3) = 0
(-1)*1.5*DMG.E(>3) + DMG.E(6) = 0
(-1)*1.5*DMG.E(>5) + DMG.E(9) = 0
(-1)*1.5*DMG.E(>7) + DMG.E(12) = 0

DMG.A2() ~ 0.01 # 某次战斗伤害翻倍
(-1)*1.1*DMG.A(>1) + DMG.E(2) ~ 0
(-1)*1.1*DMG.A(>3) + DMG.E(4) ~ 0
(-1)*1.1*DMG.A(>5) + DMG.E(6) ~ 0
(-1)*1.5*DMG.E(>7) + DMG.E(7) ~ 0

```



---

### 增强行为

基本定义：
```python
ATK(x) = DEF(x) = V(x) = 0.2*x
V(-x) = -V(x) 
V.sel(x) = -0.5*V(x)

1/p(V) = 1.5      # 对方主动使用了增强

# 例如：
DEF(5) = ATK(5) = 1

ATK(10) = 2    
# 选择我方场上一只怪物，下次攻击攻击力+10

-DEF(-10) = 2
# 我方选择对方场上一只怪物防御力-10

```

推论：
```python
ATK(13) - 1.5*DEF(2) = 2  
# 当我方怪物攻击（防御力增加>1的）怪物时，该次攻击攻击力+13。

-ATK(-13) - 1.5*ATK(2) = 2  
# 当对方（攻击力增加>1的）怪物攻击我方怪物时，该次攻击攻击力-13。

```

高阶定义：
```python
ATK.lock(x) = ATK(x)

# 例如：
ATK.lock(5) = 1
# 作用于永续预言卡，我方场上某一只怪物只要攻击，攻击力+5

ATK.lock(15) - DEF.lock(5) = 1
# 作用于永续预言卡，我方场上某一只怪物防御力-5, 只要攻击，攻击力+10
```
高阶定义：
```python
ATK2(.) = ATK(5)
# 攻击力+5 期望等于 攻击力翻倍
ATK3(.) = ATK(10)
```

高阶定义：
```python

ATK-ALL(x) = ATK(1.5*x)

ATK-ALL(3) = 0.9
# 我方所有怪物下次攻击攻击力+3
```

高阶定义：
```python

ATK.rand(x) = ATK(0.75*x)

# 例如：
ATK.rand(7) = 1.05 ~ 1
# 我方场上随机一只怪物攻击力+7

-ATK.rand(-7) = 1.05 ~ 1
# 对方场上随机一只怪物攻击力+7

-DEF.rand(7) + ATK(5)  = 0
# 对方随机一只怪物防御力+7, 我方一只怪物下次攻击攻击力+5。

```
高阶定义：
```python
ATK.sel(x) = ATK(0.5*x)
ATK.sel(-x) = ATK.sel(x)

ATK.sel(10) = 1
# 对方选择我方一只怪物攻击力+10

-DEF.sel(-10) = 1
# 对方选择对方一只怪物防御力-10

-DEF.sel(10) + ATK(5) = 0
# 对方选择对方一只怪物防御力+10，我方选择我方一只怪物攻击力 + 5

```

增强与增伤
```python

ATK(5) + DMG.A(6) = 2
# 我方一只怪物下次攻击攻击力+5, 造成的战斗伤害+6

ATK(5) + DMG.A2() = 2
# 我方一只怪物下次攻击攻击力+5, 造成的战斗伤害翻倍

ATK(5) + DMG.E2() = 2
# 我方一只怪物下次攻击攻击力+5, 战斗伤害追加同等效果伤害

```

### 御灵行为

基本定义：
```python
MANA(x) = x

1/p(MANA) = 1.3           # 对方主动获得或使用了MANA
1/p(MANA(x)) = 1.5      # 对方主动获得了MANA
1/p(MANA(-x)) = 1.5       # 对方主动使用了MANA

# 例如：
MANA(1) = 1
# 我方获得1点灵力自由分配

-MANA(-1) = 1
# 我方耗损对方1点灵力

MANA(2) = 2
# 我方获得2点灵力自由分配

- 1.5*MANA.use(>1) + MANA(3) = 0
# 当对方此回合使用了(>1)的灵力，我方获得3点灵力自由分配

MANA(-1) + MANA(1) = 0
# 转移我方场上一点灵力

- MANA(1) + MANA(1) = 0
# 对方选择我方一点灵力消除，我方选择对方一点灵力消除

（-1）* MANA(1) + MANA(1) = 0
# 我方此回合若使用了一点灵力，我方获得1点灵力自由分配

```

行为表：
| Explanation | Source  | Target | Target effect | Formula | 
|:------|:------------|:-----------|:------------| --------------:|
| 我方获得灵力| 我方     | 我方 | 获得  |  MANA(x)  |
| 我方耗损灵力 | 我方     | 我方 | 耗损  |  MANA(-x)  |
| 我方给予对方灵力 | 我方      | 对方 | 获得 | -MANA(x)|
| 我方耗损对方灵力 | 我方      | 对方 | 耗损 | -MANA(-x)|
| 对方给予我方灵力 | 对方     | 我方 | 获得 | MANA.sel(x) |
| 对方耗损我方灵力 | 对方     | 我方 | 耗损 | MANA.sel(-x) |
| 对方获得灵力 | 对方      | 对方 | 获得  | -MANA.sel(x) |
| 对方耗损灵力 | 对方      | 对方 | 耗损  | -MANA.sel(-x) |
| 我方随机获得灵力 | -      | 我方 | 随机获得   | MANA.rand(x)|
| 对方随机获得灵力  | -      | 对方 | 随机获得 | -MANA.rand(x) |
| 我方随机耗损灵力 | -      | 我方 | 随机耗损   | MANA.rand(-x)|
| 对方随机耗损灵力  | -     | 对方 | 随机耗损  | -MANA.rand(-x) |

高阶定义：
```python
MANA.rand(x) = 0.8*x

MANA.rand(4) - DMG(16) = 2
# 信仰-16, 随机获得4点灵力

```

高阶定义：
```python
MANA.sel(x) = 0.5*x

MANA.sel(2) = 1
# 对方分配2点灵力给我方

-MANA.sel(-2) = 1
# 对方自选消耗两点灵力

```

高阶定义：
```python
MANA.lock(x) = 0.8*x

MANA(-4) + MANA.lock(5) = 0
# 将我方场上至多4点灵力汇聚到一张怪物上，其灵力额外+1

-DMG(8) + MANA.lock(2)  = 0
# 我方信仰-8, 场上一只怪物 + 2灵力


```

---

-（1）从卡堆随机获得一张手牌
-（-1）随机归置一张手牌
-（3）从卡堆随机使用一张场牌
-（-3）随机归置一张场牌
-（2）随机使用一张手牌
-（-2）随机收回一张场牌
- （1）一次额外攻击
- （1）一次技能刷新
- （2）一次效果回响
- （1）1点灵力（从卡堆顶部抽取）
- （0.5）查看对方一张手牌
- （0.2）查看卡堆顶